---
title: "【Docker】failed to compute cache key エラーで30分溶かした原因はパス指定だった"
emoji: "🐳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["docker", "troubleshooting", "beginner", "ポエム"]
published: true
---

# はじめに

Docker を触り始めた頃、Image がどうしてもビルドできず、30 分くらいログとにらめっこしたことがあります。

結論から言うと、原因は**自分のファイルパスの書き方が雑すぎただけ**でした。
あまりに単純なミスですが、意外とハマる人が多いので、自戒の意味も込めて備忘録として残します。

# 発生したエラー

`docker build` を叩くと、以下のようなメッセージが出て止まりました。

```bash
failed to compute cache key: failed to walk /app/src: lstat /app/src: no such file or directory
```

はいはい、「そんなディレクトリ無いよ」案件ね……と思いきや、自分のローカル（VSCode 上）にはちゃんと存在しているのです。 「Docker が突然反抗期になった？」みたいな気持ちで調べ始めましたが、もちろんそんなことはありませんでした。

## 結論：Dockerfile のパス指定をミスっていた

当時の Dockerfile の中身はこんな感じでした。

```bash
WORKDIR /app
COPY ./src /app/src
```

一見何の問題もないように見えますが、実際のプロジェクト構造はこうなっていました。

```bash
project/ (ルート)
├── Dockerfile <-- ここで build コマンドを実行
└── backend/
    └── src/ <-- 本当にコピーしたかったディレクトリ
```

つまり本来書くべきは、以下のパスでした。

```bash
# backend ディレクトリを挟む必要があった
COPY ./backend/src /app/src
```

当たり前ですが、Docker build の**ビルドコンテキスト（Build Context）**は、指定しない限り「コマンドを実行しているカレントディレクトリ」がルートになります。

私は project/ 直下でコマンドを叩いていたのに、頭の中では backend/ の中にいるつもりで ./src と書いてしまっていたのです。

## なぜ気づきにくかったか

地味にハマる理由がいくつかあります。

1. VSCode のファイルツリーは容赦なく錯覚させる
   人間の脳って、近くにある項目を“同じ階層”だと思い込みがちです。 VSCode のファイルツリー上では Dockerfile と src が近く見える位置にあったせいで、「同じ階層にあるじゃん」と脳が勝手に補完してしまっていました。

2. Docker のエラーメッセージが微妙に親切じゃない
   no such file or directory だけでは、「ローカル（ホスト）に無い」のか「コンテキスト（Docker が見ている範囲）に無い」のかが直感的に分かりづらいです。 慣れていないと、ここで「ローカルにはあるのに！」という思考ループに陥ります。

# 学んだこと

今回のミスから得た教訓は単純ですが、エンジニアとして重要なことでした。
Dockerfile は「どこから見ているか（Context）」を常に意識する
コマンドを叩く場所と、ファイルの相対位置関係を毎回整理する癖をつける
COPY のパスバグは真っ先に疑う

ビルドが cache key エラーで止まったら、まず「パスがズレてないか？」を疑うだけでストレスが減ります。

“あるあるミス”ほど人は気づけない
派手なバグより、こういう「思い込み由来のバグ」のほうが解決に時間がかかります。

# まとめ

30 分溶かして気づいたのは、**「Docker のバグじゃなくて、自分のパスがズレてただけ」**という残酷な真実でした。 でも、こういうミスを一つずつ潰す過程で「ビルドコンテキスト」への理解が深まりました。

同じようにハマった人がいれば、この記事で少しでも救われますように。
